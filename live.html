<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>YAAO</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>

    <!--
    <link rel="stylesheet" href="styling.css">
    -->

    <link rel="stylesheet" type="text/css" href="/css/style-live.css">

    <script src="/js/scripts-live.js"></script>

</head>

<body class="m-0 border-0 m-0 border-0">
    <img id="overlayBackgroundImage" src="/img/AD OL.png" width="100%">

    <!-- Top Navbar for the player names, their chosen pilot, and their remaining hit points -->
    <nav class="navbar top-navbar">
        <div class="container-fluid">

            <!-- Left elements for player 1 -->
            <div>
                <span id="playerPilotElement1" class="pilot-label-element text-left">Pilot 1</span>
                <br>
                <span id="playerNameSpan1" class="player-name-element" >Player 1</span>
                <br>
                <label id="hpLabelPlayer1" class="hp-elements">HIT POINTS:</label>
            </div>

            <!-- Right elements for player 2 -->
            <div class="text-right">
                <span id="playerPilotElement2" class="pilot-label-element text-right">Pilot 2</span>
                <br>
                <span id="playerNameSpan2" class="player-name-element" >Player 2</span>
                <br>
                <label id="hpLabelPlayer2" class="hp-elements">HIT POINTS:</label>
            </div>
        </div>
    </nav>

    <!-- Bottom player battle cards navbar -->

    <nav id="battleCardNavbar" class="navbar fixed-bottom">

        <div>
            <img id="battleCardImgPlayer1" class="battle-card-img" src="">
        </div>

        <div>
            <img id="battleCardImgPlayer2" class="battle-card-img" src="">
        </div>


    </nav>

    <!-- Bottom player pilot cards navbar -->

    <nav class="navbar fixed-bottom">
        <div class="container-fluid">
            <img id="pilotCardImgPlayer1" class="pilot-card-img"
                src="https://www.aerodomebuilder.com/images/pilots/AEF005.png">
            <img id="pilotCardImgPlayer2" class="pilot-card-img"
                src="https://www.aerodomebuilder.com/images/pilots/AEF005.png">
        </div>
    </nav>

    <!-- Card image Modal -->
    <div id="cardImageModal" class="modal">
        <div class="modal-dialog modal-dialog-centered modal-xl">
            <div class="modal-content">
                <img id="cardImage">
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        var socket = io();

        /*
        function emitPlayerHPUpdate(playerNumber, newValue) {
            socket.emit('update', ["HP", playerNumber, newValue]);
        }

        function emitPlayerNameUpdate(playerNumber, newName) {
            socket.emit('update', ["Name", playerNumber, newName]);
        }

        function emitPlayerTTSStringUpdate(playerNumber, newTTSString) {
            socket.emit('update', ["TTSString", playerNumber, newTTSString]);
        }

        function emitPlayerPilotUpdate(playerNumber, newPilotName) {
            socket.emit('update', ["Pilot", playerNumber, newPilotName]);
        }

        function emitTogglePilotCard(pilotName) {
            socket.emit('update', ["TogglePilotCard", 1, pilotName]);
        }

        function emitToggleBattleCard(cardName) {
            socket.emit('update', ["ToggleBattleCard", 2, cardNumber]);
        }
        */

        var cardImgElement = document.getElementById("cardImage");
        var cardImgModal = document.getElementById("cardImageModal");

        socket.on('update', function (update) {
            console.log("Received update:", update);
            var command = update[0];
            var playerNumber = update[1];    
            switch (command) {
                case "HP":  
                    var targetElementId = "hpLabelPlayer" + playerNumber;
                    document.getElementById(targetElementId).innerText = "HIT POINTS: " + update[2];
                    break;
                case "Name":
                    var targetElementId = "playerNameSpan" + playerNumber;
                    document.getElementById(targetElementId).innerText = update[2];
                    break;
                case "Pilot":
                    var targetElementId = "playerPilotElement" + playerNumber;
                    document.getElementById(targetElementId).innerText = update[2];
                    updatePlayerPilotCard(playerNumber);
                    break;
                case "TogglePilotCard":
                    var pilotNameElement = "playerPilotElement" + playerNumber;
                    var selectedPilotName = document.getElementById(pilotNameElement).innerText.trim();
                    cardImgElement.src = getPilotImgURLForPilotName(selectedPilotName);
                    $('#cardImageModal').modal('toggle');
                    break;
                case "ToggleSmallPilotCard":
                    var pilotCardImageElement = document.getElementById("pilotCardImgPlayer" + playerNumber);
                    var newHeight = "250px";
                    if (pilotCardImageElement.style.height == newHeight) {
                        newHeight = "25px";
                    }
                    console.log("Setting the height for " + pilotCardImageElement.id + " to " + newHeight);
                    pilotCardImageElement.style.height = newHeight;
                    break;
                case "TTSString":
                var targetElementId = "playerPilotElement" + playerNumber;
                    var cardArray = update[2].split("\\ ");
                    console.log(cardArray);
                    var pilotCode = cardArray.filter((cardCode) => cardCode.startsWith("AEF0"))[0].trim();
                    var selectedPilotName = convertPilotCodeToPilotName(pilotCode);
                    console.log("New pilot name: ", selectedPilotName);
                    document.getElementById(targetElementId).innerText = selectedPilotName;
                    updatePlayerPilotCard(playerNumber);
                    break;
                case "ToggleBattleCard":
                    console.log("Received new battle card image: ", update[2]);
                    cardImgElement.src = update[2];
                    $('#cardImageModal').modal('toggle');
                    break;                    
            }
        });
    </script>

</body>

</html>